Team_to_Assign_Bots = TEAM_SPECTATOR
Number_of_Free_Slots = 28

Bot_Names = {
"ShadowNinja",
"FireBlaze",
"IronSpartan",
"MysticWizard",
"LightningStrike",
"IcePhoenix",
"DarkKnight",
"CyberHawk",
"SilverBullet",
"BlazeFury",
"StarGazer",
"CrimsonWraith",
"ThunderSword",
"FrostFang",
"Nightshade",
"StormChaser",
"BioHazard",
"VenomSpike",
"SkyDancer",
"XenoHunter",
"SoulReaver",
"NovaGuardian",
"AtomicGamer",
"NeonNinja",
"DragonHeart",
"TimeTraveler",
"GalacticWarrior",
"QuantumRider",
"OmegaWolf",
"SolarFlare",
"LunarEclipse",
"SpacePirate",
"GhostRecon",
"NeonSpecter",
"InfernoBlitz",
"VoidWalker",
"EternalDragon",
"StealthSniper",
"BladeMaster",
"SteelSamurai",
"ThunderStrike",
"IceWeaver",
"PhantomThief",
"NovaStriker",
"ShadowRogue",
"CyberSamurai",
"GalacticNinja",
"FrostBite",
"StarshipTrooper",
"ApexPredator",
"NeoWarrior",
"DeathBringer",
"PhoenixRider",
"QuantumHacker",
"SpectralKnight",
"StormSurge",
"FrostGuard",
"SilverLion",
"BladeStorm",
"VoidWanderer",
"InfernoDancer",
"AstralGuardian",
"CyberRonin",
"IceShaman",
"NovaPhantom",
"ThunderWraith",
"SoulEater",
"ShadowReaper",
"ChaosMage",
"LaserBlaster",
"AtomicStorm",
"VenomViper",
"StarshipPilot",
"AlphaWolf",
"GalacticOverlord",
"TimeBender",
"CrystalSorcerer",
"IronPatriot",
"CyberNinja",
"NightSaber",
"DeathDealer",
"BladeWielder",
"StormCaller",
"SpaceMarine",
"NovaGuard",
"FireFox",
"IceMage",
"ShadowStrider",
"QuantumKnight",
"NeonAssassin",
"DarkPhoenix",
"PlasmaBlade",
"ThunderSorcerer",
"LunarNinja",
"SoulStealer",
"DragonSlayer",
"NovaVanguard",
"MetalHawk",
"StarSeeker",
"Avalanche",
"CrystalStorm",
"NeonPhantom",
"IceWarden",
"ShadowMage",
"TimeGuardian",
"CyberHunter",
"QuantumSorcerer",
"LunarSpecter",
"StormWalker",
"VenomFang",
"DeathWraith",
"FireSorcerer",
"BladeDancer",
"SilverStrider",
"NovaKnight",
"DarkStar",
"SolarBlaze",
"BlizzardMage",
"ThunderDragon",
"GalacticStorm",
"ShadowWarden",
"IceBolt",
"TimeShifter",
"QuantumReaper",
"StormBlitz",
"DeathKnight",
"NeonViper",
"DragonMage",
"BladeFury",
"SoulHunter",
"NightFang",
"SpectralSorcerer",
"SilverShadow",
"StarLight",
"CyberSorcerer",
"VoidWraith",
"NovaHawk",
"IceDragon",
"QuantumPhantom",
"VenomHunter",
"StormBlade",
"PlasmaSorcerer",
"GalacticMage",
"LunarWarden",
"DarkIce",
"FireSpecter",
"DragonBlaze",
"BlizzardSorcerer",
"ShadowDragon",
"TimeMage",
"NeonShadow",
"SilverMage",
"CyberBlade",
"ThunderSpecter",
"StarFlame",
"VoidSorcerer",
"SoulBlade",
"QuantumDragon",
"NovaSorcerer",
"IceStorm",
"DeathShadow",
"GalacticDragon",
"LunarSorcerer",
"FireDragon",
"StarSorcerer",
"BladeShadow",
"DarkStorm",
"SpectralDragon",
"ThunderMage",
"VenomSorcerer",
"TimeBlade",
"NovaWarden",
"SilverSorcerer",
"PlasmaMage",
"DragonSorcerer",
"QuantumWarden",
"BladeStar",
"IceSorcerer",
"SoulSorcerer",
"ShadowStar",
"StarDragon",
"LunarDragon",
"StormDragon",
"DeathSorcerer",
"NeonBlade",
"FireWarden",
"DarkDragon",
"GalacticSorcerer",
"ThunderShadow",
"NovaBlade",
"VenomDragon",
"TimeDragon",
"QuantumMage",
"SpectralSpecter",
"SilverDragon",
"VoidMage",
"BladeMage",
"IceShadow",
"DragonWarden",
"LunarStar",
"NeonFire",
"FireStorm",
"StormSorcerer",
"StarStorm",
"SoulMage",
"DarkSorcerer",
"PlasmaDragon",
"ThunderWarden",
"VenomShadow",
"NovaStar",
"GalacticWarden",
"TimeShadow",
"BladeWarden",
"IceFlame",
"SpectralFire",
"QuantumBlade",
"DragonStar",
"SilverBlade",
"VoidStar",
"LunarMage",
"NeonStorm",
"FireSpectral",
"StormShadow",
"DarkWarden",
"SoulStar",
"VenomStar",
"PlasmaSpectral",
"GalacticShadow",
"ThunderDragon",
"IceDragon",
"TimeSorcerer",
"NovaDragon",
"QuantumStorm",
"BladeStar",
"StarBlade",
"NeonBlade",
"DarkBlade",
"SoulDragon",
"SilverWarden",
"VenomWarden",
"LunarSpectral",
"PlasmaWarden",
"GalacticBlade",
"ThunderStar",
"TimeStar",
"IceStar",
"QuantumStar",
"NovaShadow",
"BladeWarden",
"SpectralSorcerer",
"DarkSpectral",
"FireDragon",
"NeonSorcerer",
"SoulSpectral",
"VenomSpectral",
"ThunderWarden",
"GalacticSpectral",
"IceWarden",
"TimeWarden",
"BladeDragon"
}

Save_Player_Names = true

Max_Names_to_Save = false

Bot_Name_Filter = {
"^%b()", 
".com",
".net",
".org",
".info",
".co.uk",
"http",
"www",
} 
Bot_Identifier = ""
Bot_Timer_Check = 1

timer.Simple(2, function()

if GAMEMODE_NAME == "prophuntz" then
end

if (ULib and ULib.bans) then
--ULX has some strange bug / issue with NextBot's and Player Authentication.
--[[
[ERROR] Unauthed player
  1. query - [C]:-1
   2. fn - addons/ulx-v3_70/lua/ulx/modules/slots.lua:44
    3. unknown - addons/ulib-v2_60/lua/ulib/shared/hook.lua:110
]]
	--Fix above error by adding acception for bots to the ulxSlotsDisconnect hook.
	hook.Add("PlayerDisconnected", "ulxSlotsDisconnect", function(ply)
		--If player is bot.
		if ply:IsBot() then
			--Do nothing.
			return
		end
	end)
end

end) 

function DelayedBotConnect()
    local randomConnectTime = math.random(MinBotConnectTime, MaxBotConnectTime)
    
    timer.Simple(randomConnectTime, function()
        -- Maintenant, connectez un bot ici
        local botName = RandomName()
        player.CreateNextBot(Bot_Identifier .. botName)

        if Team_to_Assign_Bots ~= false then
            for k, v in pairs(player.GetBots()) do
                if v:Team() ~= Team_to_Assign_Bots then
                    v:KillSilent()
                    v:SetTeam(Team_to_Assign_Bots)
                end
            end
        end
    end)
end

-- Fonction pour randomiser les emplacements des bots
function RandomizeBotSlots()
    for _, bot in pairs(player.GetBots()) do
        local newSlot = math.random(8, 24)
        bot:SetNWInt("BotSlot", newSlot)
    end
end

-- Démarrez la randomisation des emplacements toutes les 5 minutes
timer.Create("RandomizeBotSlotsTimer", 5, 0, RandomizeBotSlots)

-- Fonction pour supprimer les bots déconnectés
function RemoveDisconnectedBots()
    for _, bot in pairs(player.GetBots()) do
        if !bot:IsValid() then
            bot:Remove()
        end
    end
end

-- Vérifiez régulièrement les bots déconnectés
timer.Create("RemoveDisconnectedBotsTimer", 5, 0, RemoveDisconnectedBots)

function RandomName()
	BotNames = {}

	--If save player names is true then allow us to create data file.
	if Save_Player_Names == true then
		if file.Exists("BotNames.txt", "DATA") then
			--Read our file.
			local lol = file.Read("BotNames.txt", "DATA")
			--Put our file data into a table.
			data = string.Explode("\n", lol)
			--For each name in our table.
			for i=1, #data do
				--Add name to the table of names.
				table.insert(BotNames, data[i])
			end
		else
			--file did not exist so create it and add player names.
			for i=1, #Bot_Names do
				--For the first instance we create the file.
				if i == 1 then
					--Create file and add name from table.
					file.Write("BotNames.txt", ""..Bot_Names[i].."")
				else
					--Add the new name to the file.
					file.Append("BotNames.txt", "\n"..Bot_Names[i].."")
				end
				--Add name to the table of names.
				table.insert(BotNames, Bot_Names[i])
			end
		end
	else --Save names is not true so Don't create any files.
		--For each bot name in our table.
		for i=1, #Bot_Names do
			--Add name to the table of names.
			table.insert(BotNames, Bot_Names[i])
		end
	end

	--Prevent bots getting the same name as existing bots/players.
	local Players = player.GetAll()
	--For each player.
	for i=1, #Players do
		--If player name is found within table.
		if table.HasValue(BotNames, Players[i]:GetName()) then
			--Remove the name from the table.
			table.remove(BotNames, table.KeyFromValue(BotNames, Players[i]:GetName()))
		end
	end

	--Randomize the output.
	output = table.Random(BotNames)

    return output
end

--Add names of legit players to our database of names for future usage.
function AddNametoDatabase(name)

	--TODO : Improve this pattern matching / filtering technique.
	for i=1, #Bot_Name_Filter do
		--[[ Nulled out this code to use regex for upper / lower case matching.
		--lower case matches.
		if name:lower():find(Bot_Name_Filter[i]) then
			--Filter out string and replace with nothing.
			name = name:gsub(Bot_Name_Filter[i], "")
		end
		--upper case matches.
		if name:upper():find(Bot_Name_Filter[i]) then
			--Filter out string and replace with nothing.
			name = name:gsub(Bot_Name_Filter[i], "")
		end]]
		--For exact matches
		if name:find(Bot_Name_Filter[i]) then
			--Filter out string and replace with nothing.
			name = name:gsub(Bot_Name_Filter[i], "")
		end
	end

	if file.Exists("BotNames.txt", "DATA") then
		--Read our file.
		local lol = file.Read("BotNames.txt", "DATA")
		--Put our file data into a table.
		data = string.Explode("\n", lol)
		--Prevent the file becomming larger than we say.
		if table.Count(data) <= Max_Names_to_Save or Max_Names_to_Save == false then
			--Only add names to database that do not exist.
			if !table.HasValue(data, name) then
				--Add the new name to the file.
				file.Append("BotNames.txt", "\n"..name.."")
			end
		end
	else
		--file did not exist so create it and add player name.
		file.Write("BotNames.txt", ""..name.."")
	end
end

-- Fonction pour ajouter ou kicker des bots aléatoirement
function AddOrKickRandomBots()
    local action = math.random(1, 2)  -- 1 pour ajouter, 2 pour kicker
    if action == 1 then
        local numToAdd = math.random(1, 3)  -- Nombre aléatoire de bots à ajouter (ajustez selon vos préférences)
        for i = 1, numToAdd do
            local botSlot = math.random(4, 28)
            local botName = Bot_Identifier .. RandomName()
            
            -- Créez le bot et attribuez-lui un nom
            local bot = player.CreateNextBot(botName)
            bot:SetNWInt("BotSlot", botSlot)
            bot:SetTeam(TEAM_SPECTATORS)
            
            -- Attribuez des valeurs factices aux champs "SteamID" et "IPAddress"
            bot:SetNWString("SteamID", "STEAM_0:1:23433387")  -- SteamID factice
            bot:SetNWString("Ip", "192.168.0.1")  -- Adresse IP factice
        end
    else
        local bots = player.GetBots()
        if #bots > 0 then
            local randomIndex = math.random(1, #bots)
            local randomBot = bots[randomIndex]
            randomBot:Kick("Bot has been kicked.")
        end
    end

    local nextDelay = math.random(60, 300)  -- Délai aléatoire entre 1 et 5 minutes
    timer.Simple(nextDelay, AddOrKickRandomBots)
end

-- Obtenez la liste des joueurs (y compris les bots)
local players = player.GetAll()

-- Parcourez tous les joueurs
for _, ply in pairs(players) do
    -- Vérifiez si le joueur est un bot
    if ply:IsBot() then
        -- Obtenez le SteamID et l'adresse IP du bot
        local steamID = ply:GetNWString("SteamID", "N/A")
        local Ip = ply:GetNWString("Ip", "N/A")

        -- Affichez les valeurs du SteamID et de l'adresse IP
        print("Bot Name: " .. ply:Nick())
        print("SteamID: " .. steamID)
        print("IPAddress: " .. Ip)
    end
end

-- Fonction pour générer une adresse IP aléatoire
function GenerateRandomIPAddress()
    local ip = ""
    for i = 1, 4 do
        ip = ip .. math.random(0, 255)  -- Générer un octet aléatoire (0 à 255)
        if i < 4 then
            ip = ip .. "."  -- Ajouter un point entre les octets sauf pour le dernier
        end
    end
    return ip
end

-- Fonction pour générer un faux SteamID au format STEAM_X:Y:Z
function GenerateFakeSteamID()
    local x = math.random(0, 1) -- Valeur aléatoire de X (0 ou 1)
    local y = math.random(0, 1) -- Valeur aléatoire de Y (0 ou 1)
    local z = math.random(1000000, 9999999) -- Valeur aléatoire de Z (entre 1000000 et 9999999)
    
    return "STEAM_" .. x .. ":" .. y .. ":" .. z
end

-- Utilisez GenerateBots() dans hook.Add("InitPostEntity", ...) pour le changement de carte et le redémarrage du serveur
hook.Add("InitPostEntity", "InitPostEntity-Spoof-Player-Count", function()
    AddOrKickRandomBots()
end)

-- Utilisez GenerateBots() dans hook.Add("PlayerDisconnected", ...) pour le remplacement des bots
hook.Add("PlayerDisconnected", "PlayerDisconnected-SpawnBot", function(ply)
    AddOrKickRandomBots()
end)


--Assign all bots to a single team rather than let your game mode balance them.
if Team_to_Assign_Bots != false then
	--When a bot spawns for the first time set their team.
	function BotInitialSpawnTeamSwitch(ply)
		--If player is bot and not on the team specified.
		if ply:IsBot() and ply:Team() != Team_to_Assign_Bots then
			--Some game modes are stupid so we need to kill the bot before switching team.
			--ply:Kill()
			ply:KillSilent()
			--Team to put the bots on.
			ply:SetTeam(Team_to_Assign_Bots)
		end
	end
	hook.Add("PlayerInitialSpawn", "PlayerInitialSpawn-BotInitialTeamSwitch", BotInitialSpawnTeamSwitch)

	--When a bot spawns set their team.
	function BotTeamSwitch(ply)
		--If player is bot and not on the team specified.
		if ply:IsBot() and ply:Team() != Team_to_Assign_Bots then
			--Some game modes are stupid so we need to kill the bot before switching team.
			--ply:Kill()
			ply:KillSilent()
			--Team to put the bots on.
			ply:SetTeam(Team_to_Assign_Bots)
		end
	end
	hook.Add("PlayerSpawn", "PlayerSpawn-BotTeamSwitch", BotTeamSwitch)
end

--When player connects remove a bot and give them the bots slot.
function ConnectKillBot(ply)
	--[[
	--Select a random bot.
	RandomBot = player.GetBots()[math.random(1,#player.GetBots())]
	--If player is not a bot.
	if !ply:IsBot() then
		--Goodbye bot.
		RandomBot:Kick()
	end
	]]

	--If player connecting is not a bot.
	if !ply:IsBot() then

		--Set distance.
		local distance = 0
		--Set target as nil.
		local target

		--For all bots.
		for k,v in pairs(player.GetBots()) do
			--If player is dead.
			if v:Health() <= 0 then
				--Kick the dead bot.
				v:Kick()
				--Prevent the script from executing any further.
				return
			else --Else no bots are dead.
				--For all human players.
				for p,ply in pairs(player.GetHumans()) do
					--If not self. (No point in checking our own position.)
					if ply:GetPos() != v:GetPos() then
						--If the length of the next target is more than the last length found (target is further away than previous).
						if ((v:GetPos() - ply:GetPos()):Length() > distance) then
							--Set distance to the length furthest player.
							distance = (v:GetPos() - ply:GetPos()):Length()
							--Set new found target.
							target = v
						end
					end
				end
			end
		end

		--If a target is set.
		if target != nil then
		    timer.Simple(1, function()
        -- ...
        DelayedBotConnect()
		end)
			target:Kick()
		end
	end
end
hook.Add("PlayerAuthed", "PlayerAuthed-KillBot", ConnectKillBot)

timer.Create("Timer-Loop-Spoof-Player-Count", Bot_Timer_Check, 0, function()
	if #player.GetHumans() + #player.GetBots() <= game.MaxPlayers() - Number_of_Free_Slots then
		CurrentPlayerCount = #player.GetHumans() + #player.GetBots()
		FillSlots = game.MaxPlayers() - Number_of_Free_Slots

		for i=1, FillSlots - CurrentPlayerCount do
			player.CreateNextBot(""..Bot_Identifier..""..RandomName().."")
			--RunConsoleCommand("bot")
		end

		if Team_to_Assign_Bots != false then
			for k,v in pairs(player.GetBots()) do
				if v:Team() != Team_to_Assign_Bots then
					v:KillSilent()
					v:SetTeam(Team_to_Assign_Bots)
				end
			end
		end
	end
end)

-- Supprimez les bots du tableau des scores
hook.Add("PHZ:ScoreboardShow", "HideBotsFromScoreboard", function()
    local players = player.GetAll()
    local filteredPlayers = {}

    for _, ply in pairs(players) do
        -- Vérifiez si le joueur n'est pas un bot avant de l'inclure dans la liste filtrée
        if not ply:IsBot() then
            table.insert(filteredPlayers, ply)
        end
    end

    -- Supprimez tous les joueurs actuels du tableau des scores
    for _, v in pairs(player.GetAll()) do
        v:SendLua("GAMEMODE.Scoreboard:Hide()")
    end

    -- Remplacez la liste des joueurs par la liste filtrée
    GAMEMODE.Scoreboard:Show()
    GAMEMODE.Scoreboard:SetPlayerList(filteredPlayers)
end)